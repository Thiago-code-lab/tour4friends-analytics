<!-- formulario.html -->

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personalizar Roteiro - Tour4Friends</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css"> 
    <script src="chat.js" defer></script>
</head>
<body>

    <header class="header-container">
        <div class="container">
            <div class="header">
                <a href="index.html" class="logo">
                    <span class="logo-icon">‚òÄÔ∏è</span>tour4friends
                </a>
                <nav>
                    <ul class="nav-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="formulario.html">Roteiros</a></li>
                        <li><a href="minhas_reservas.html">Minhas Reservas</a></li>
                    </ul>
                </nav>
                <div class="user-profile">
                    <span id="nome-usuario">Ol√°, Visitante</span>
                    <div class="user-icon">üë§</div>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="quiz-container">
            <h3>Personalize seu roteiro:</h3>
            
            <form id="personalize-form">

                <div class="form-step active" data-step="1">
                    <p class="question-text">1. Quem √© voc√™ e o que o Caminho de Santiago representa neste momento da sua vida?</p>
                    <div class="options-group">
                        <div class="option">
                            <input type="radio" id="q1-op1" name="q1" value="paz">
                            <label for="q1-op1">Sou peregrino em busca de paz, reflex√£o e desconex√£o do trabalho.</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q1-op2" name="q1" value="desafio">
                            <label for="q1-op2">Vejo o Caminho como um grande desafio pessoal e uma aventura f√≠sica.</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q1-op3" name="q1" value="mudanca">
                            <label for="q1-op3">Estou em uma fase de mudan√ßa e busco clareza para o futuro.</label>
                        </div>
                    </div>
                </div>

                <div class="form-step" data-step="2">
                    <p class="question-text">2. Qual √© o seu ritmo de caminhada preferido?</p>
                    <div class="options-group">
                        <div class="option">
                            <input type="radio" id="q2-op1" name="q2" value="moderado">
                            <label for="q2-op1">Gosto de caminhar sem pressa, parando para fotos. (Lento/Moderado)</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q2-op2" name="q2" value="focado">
                            <label for="q2-op2">Prefiro ritmo constante para chegar cedo. (Focado)</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q2-op3" name="q2" value="rapido">
                            <label for="q2-op3">Sou atleta, quero o m√°ximo de quil√¥metros. (R√°pido/Desafiador)</label>
                        </div>
                    </div>
                    <div class="step-navigation">
                        <button type="button" class="btn-prev">&larr; Voltar</button>
                    </div>
                </div>

                <div class="form-step" data-step="3">
                    <p class="question-text">3. Que tipo de acomoda√ß√£o voc√™ prioriza?</p>
                    <div class="options-group">
                        <div class="option">
                            <input type="radio" id="q3-op1" name="q3" value="albergue">
                            <label for="q3-op1">Albergues p√∫blicos/paroquiais (Experi√™ncia social).</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q3-op2" name="q3" value="privado">
                            <label for="q3-op2">Albergues privados ou pens√µes (Menos pessoas).</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q3-op3" name="q3" value="conforto">
                            <label for="q3-op3">Hot√©is e Pousadas de charme (Conforto total).</label>
                        </div>
                    </div>
                    <div class="step-navigation">
                        <button type="button" class="btn-prev">&larr; Voltar</button>
                    </div>
                </div>

                <div class="form-step" data-step="4">
                    <p class="question-text">4. Com quem voc√™ planeja fazer a viagem?</p>
                    <div class="options-group">
                        <div class="option">
                            <input type="radio" id="q4-op1" name="q4" value="sozinho">
                            <label for="q4-op1">Vou sozinho(a). Aberto a conhecer pessoas.</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q4-op2" name="q4" value="casal">
                            <label for="q4-op2">Vou com meu/minha parceiro(a).</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q4-op3" name="q4" value="amigos">
                            <label for="q4-op3">Vou com um grupo de amigos.</label>
                        </div>
                    </div>
                    <div class="step-navigation">
                        <button type="button" class="btn-prev">&larr; Voltar</button>
                    </div>
                </div>

                <div class="form-step" data-step="5">
                    <p class="question-text">5. Qual √© seu n√≠vel de experi√™ncia com trilhas longas?</p>
                    <div class="options-group">
                        <div class="option">
                            <input type="radio" id="q5-op1" name="q5" value="iniciante">
                            <label for="q5-op1">Iniciante. Primeira grande aventura.</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q5-op2" name="q5" value="intermediario">
                            <label for="q5-op2">Intermedi√°rio. J√° fiz algumas trilhas.</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q5-op3" name="q5" value="experiente">
                            <label for="q5-op3">Experiente. Fa√ßo trekking regularmente.</label>
                        </div>
                    </div>
                    <div class="step-navigation">
                        <button type="button" class="btn-prev">&larr; Voltar</button>
                    </div>
                </div>

                <div class="form-step" data-step="6">
                    <p class="question-text">6. Qual seu foco principal ao visitar as cidades?</p>
                    <div class="options-group">
                        <div class="option">
                            <input type="radio" id="q6-op1" name="q6" value="historia">
                            <label for="q6-op1">Hist√≥ria e Arquitetura (Igrejas e monumentos).</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q6-op2" name="q6" value="gastronomia">
                            <label for="q6-op2">Gastronomia (Pratos locais e tapas).</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q6-op3" name="q6" value="descanso">
                            <label for="q6-op3">Descanso (A cidade √© s√≥ ponto de parada).</label>
                        </div>
                    </div>
                    <div class="step-navigation">
                        <button type="button" class="btn-prev">&larr; Voltar</button>
                    </div>
                </div>

                <div class="form-step" data-step="7">
                    <p class="question-text">7. Voc√™ prefere carregar mochila ou transporte?</p>
                    <div class="options-group">
                        <div class="option">
                            <input type="radio" id="q7-op1" name="q7" value="carregar">
                            <label for="q7-op1">Carregar minha mochila (Experi√™ncia raiz).</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q7-op2" name="q7" value="transportar">
                            <label for="q7-op2">Transporte de bagagem (Apenas mochila de ataque).</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q7-op3" name="q7" value="hibrido">
                            <label for="q7-op3">H√≠brido (Depende da etapa).</label>
                        </div>
                    </div>
                    <div class="step-navigation">
                        <button type="button" class="btn-prev">&larr; Voltar</button>
                    </div>
                </div>

                <div class="form-step" data-step="8">
                    <p class="question-text">8. Qual √© o seu or√ßamento di√°rio aproximado?</p>
                    <div class="options-group">
                        <div class="option">
                            <input type="radio" id="q8-op1" name="q8" value="economico">
                            <label for="q8-op1">Econ√¥mico (at√© 40‚Ç¨/dia).</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q8-op2" name="q8" value="conforto">
                            <label for="q8-op2">Conforto (40‚Ç¨ - 80‚Ç¨/dia).</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q8-op3" name="q8" value="flexivel">
                            <label for="q8-op3">Flex√≠vel (Acima de 80‚Ç¨/dia).</label>
                        </div>
                    </div>
                    <div class="step-navigation">
                        <button type="button" class="btn-prev">&larr; Voltar</button>
                    </div>
                </div>

                <div class="form-step" data-step="9">
                    <p class="question-text">9. Qual trecho do Caminho mais lhe atrai?</p>
                    <div class="options-group">
                        <div class="option">
                            <input type="radio" id="q9-op1" name="q9" value="frances">
                            <label for="q9-op1">Caminho Franc√™s (Tradicional e social).</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q9-op2" name="q9" value="portugues">
                            <label for="q9-op2">Caminho Portugu√™s (Costa e praias).</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q9-op3" name="q9" value="primitivo">
                            <label for="q9-op3">Caminho Primitivo (Desafio e natureza).</label>
                        </div>
                    </div>
                    <div class="step-navigation">
                        <button type="button" class="btn-prev">&larr; Voltar</button>
                    </div>
                </div>

                <div class="form-step" data-step="10">
                    <p class="question-text">10. O que voc√™ mais espera conquistar?</p>
                    <div class="options-group">
                        <div class="option">
                            <input type="radio" id="q10-op1" name="q10" value="amizades">
                            <label for="q10-op1">Novas amizades e hist√≥rias.</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q10-op2" name="q10" value="clareza">
                            <label for="q10-op2">Clareza mental e renova√ß√£o.</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q10-op3" name="q10" value="superacao">
                            <label for="q10-op3">Supera√ß√£o f√≠sica e mental.</label>
                        </div>
                    </div>
                    <div class="step-navigation">
                        <button type="button" class="btn-prev">&larr; Voltar</button>
                    </div>
                </div>

                <div class="form-step" id="final-step">
                    <p class="question-text" id="texto-final">Obrigado!</p>
                    <!-- Mensagem de status do envio -->
                    <p id="msg-status" style="font-weight: 500; color: #FF7A29; margin-bottom: 1rem;">Salvando suas respostas...</p>
                    
                    <p>Estamos personalizando as melhores op√ß√µes de roteiro para o seu perfil.</p>
                    <a href="minhas_reservas.html" class="btn-reserve" style="margin-top: 2rem;">Ver Meus Roteiros</a>
                    
                    <div class="step-navigation">
                        <button type="button" class="btn-prev">&larr; Voltar</button>
                    </div>
                </div>

            </form>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            // --- 1. PROTE√á√ÉO DE ROTA E Identifica√ß√£o ---
            const nomeSalvo = localStorage.getItem('nomeUsuario');
            const emailSalvo = localStorage.getItem('emailUsuario');
            
            // VERIFICA√á√ÉO DE LOGIN: Se n√£o tiver email, bloqueia e redireciona
            if (!emailSalvo) {
                alert("Por favor, fa√ßa login para acessar o formul√°rio de personaliza√ß√£o.");
                window.location.href = "login.html";
                return; // Impede que o resto do script rode
            }

            // Se passou da verifica√ß√£o, atualiza a interface
            if (nomeSalvo) {
                const spanNome = document.getElementById('nome-usuario');
                if (spanNome) spanNome.innerText = `Ol√°, ${nomeSalvo}`;
                
                const textoFinal = document.getElementById('texto-final');
                if (textoFinal) textoFinal.innerText = `Obrigado, ${nomeSalvo}!`;
            }

            // --- 2. Fun√ß√£o para enviar ao Banco de Dados ---
            async function enviarRespostas() {
                // Dupla checagem (seguran√ßa extra)
                if (!emailSalvo) {
                    window.location.href = "login.html";
                    return;
                }

                // Coleta todas as respostas do formul√°rio
                const respostas = {};
                for(let i=1; i<=10; i++) {
                    const el = document.querySelector(`input[name="q${i}"]:checked`);
                    respostas[`q${i}`] = el ? el.value : null;
                }

                try {
                    const response = await fetch('http://127.0.0.1:5000/salvar_quiz', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            email: emailSalvo, 
                            respostas: respostas 
                        })
                    });
                    
                    const data = await response.json();
                    const statusMsg = document.getElementById('msg-status');
                    
                    if (data.sucesso) {
                        statusMsg.innerText = "Suas respostas foram salvas com sucesso!";
                        statusMsg.style.color = "green";
                    } else {
                        statusMsg.innerText = "Erro ao salvar: " + data.mensagem;
                        statusMsg.style.color = "red";
                    }

                } catch (error) {
                    console.error(error);
                    document.getElementById('msg-status').innerText = "Erro de conex√£o com o servidor.";
                    document.getElementById('msg-status').style.color = "red";
                }
            }

            // --- 3. Navega√ß√£o do Quiz ---
            const radioButtons = document.querySelectorAll('#personalize-form input[type="radio"]');
            
            radioButtons.forEach(radio => {
                radio.addEventListener('click', function() {
                    const currentStep = this.closest('.form-step');
                    const nextStep = currentStep.nextElementSibling;
                    
                    // Se for a √∫ltima pergunta (passo 10), envia as respostas!
                    if (currentStep.dataset.step === "10") {
                        enviarRespostas();
                    }

                    setTimeout(() => {
                        if (nextStep) {
                            currentStep.classList.remove('active');
                            nextStep.classList.add('active');
                        }
                    }, 300); 
                });
            });

            const prevButtons = document.querySelectorAll('.btn-prev');
            prevButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const currentStep = this.closest('.form-step');
                    const prevStep = currentStep.previousElementSibling;
                    if (prevStep) {
                        currentStep.classList.remove('active');
                        prevStep.classList.add('active');
                    }
                });
            });

        });
    </script>

</body>
</html>